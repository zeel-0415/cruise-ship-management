<!-- movie.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Movie Booking</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
  <div class="container">
    <h2>ðŸŽ¬ Movie Booking</h2>
    <form id="movieForm">
      <label>Movie Name:
        <input type="text" id="movie" required />
      </label>

      <label>Seats:
        <input type="number" id="seats" min="1" required />
      </label>

      <button type="submit">âœ… Book</button>
      <button type="button" onclick="goBack()">ðŸ”™ Back</button>
    </form>
  </div>

  <script type="module">
    import { db, auth } from "./firebase/firebase-config.js";
    import { ref, push } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

    let userEmail = null;

    onAuthStateChanged(auth, (user) => {
      if (user) userEmail = user.email;
      else window.location.href = "index.html";
    });

    document.getElementById("movieForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const movie = document.getElementById("movie").value;
      const seats = document.getElementById("seats").value;

      await push(ref(db, "voyager-orders/movies"), {
        email: userEmail,
        movie,
        seats,
        timestamp: new Date().toISOString()
      });

      Toastify({ text: "Movie booked!", duration: 3000, gravity: "top", backgroundColor: "#28a745" }).showToast();
      e.target.reset();
    });

    function goBack() {
      window.location.href = "voyager-dashboard.html";
    }
  </script>
</body>
</html>
